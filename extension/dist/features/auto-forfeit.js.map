{"version":3,"file":"auto-forfeit.js","sources":["../../src/features/auto-forfeit.js"],"sourcesContent":["import { getFeatureID } from '../helpers/feature-helpers.js';\r\nimport { log } from './logger.js';\r\nimport features from '../feature-manager.js';\r\nimport { findProps } from '../helpers/react-resolver.js';\r\nimport ws from '../helpers/websockets.js';\r\nimport { $ } from 'select-dom';\r\n\r\nconst selector = '.css-77mr2t .btn-danger';\r\n\r\nlet forfeitCheck;\r\n\r\nasync function init(activate = true) {\r\n\r\n    if (!activate) {\r\n        return;\r\n    }\r\n\r\n    let timeout = JSON.parse(localStorage.getItem('iref_settings'))[\"auto-forfeit-m\"] || 13;\r\n\r\n    const forfeitProps = findProps($(selector));\r\n    forfeitCheck = forfeitProps.registrationStatus.subsession_id;\r\n\r\n    log(`ðŸ›‘ Forfeit button seen, beginning ${timeout} minute countdown.`);\r\n\r\n    setTimeout(() => {\r\n\r\n        const forfeitProps2 = findProps($(selector));\r\n\r\n        if (!forfeitProps2) {\r\n            log('ðŸ›‘ Forfeit button not available.');\r\n            return;\r\n        }\r\n\r\n        if (forfeitProps2.simStatus.status !== \"Sim Running\") {\r\n            log('ðŸ›‘ Sim not running, skipping forfeit.');\r\n            return;\r\n        }\r\n\r\n        if (forfeitCheck !== forfeitProps2.registrationStatus.subsession_id) {\r\n            log('ðŸ›‘ Session changed, skipping forfeit.');\r\n            return;\r\n        }\r\n\r\n        log(`ðŸ›‘ Forfeiting session ${forfeitCheck}`);\r\n\r\n        ws.withdraw();\r\n\r\n    }, timeout * 1000 * 60);\r\n}\r\n\r\nconst id = getFeatureID(import.meta.url);\r\nconst bodyClass = 'iref-' + id;\r\n\r\nfeatures.add(id, true, selector, bodyClass, init);\r\n"],"names":["selector","forfeitCheck","init","activate","timeout","findProps","$","log","forfeitProps2","ws","id","getFeatureID","bodyClass","features"],"mappings":";;;;;;AAOA,MAAMA,IAAW;AAEjB,IAAIC;AAEJ,eAAeC,EAAKC,IAAW,IAAM;AAEjC,MAAI,CAACA;AACD;AAGJ,MAAIC,IAAU,KAAK,MAAM,aAAa,QAAQ,eAAe,CAAC,EAAE,gBAAgB,KAAK;AAGrF,EAAAH,IADqBI,EAAUC,EAAEN,CAAQ,CAAC,EACd,mBAAmB,eAE/CO,EAAI,qCAAqCH,CAAO,oBAAoB,GAEpE,WAAW,MAAM;AAEb,UAAMI,IAAgBH,EAAUC,EAAEN,CAAQ,CAAC;AAE3C,QAAI,CAACQ,GAAe;AAChB,MAAAD,EAAI,kCAAkC;AACtC;AAAA,IACH;AAED,QAAIC,EAAc,UAAU,WAAW,eAAe;AAClD,MAAAD,EAAI,uCAAuC;AAC3C;AAAA,IACH;AAED,QAAIN,MAAiBO,EAAc,mBAAmB,eAAe;AACjE,MAAAD,EAAI,uCAAuC;AAC3C;AAAA,IACH;AAED,IAAAA,EAAI,yBAAyBN,CAAY,EAAE,GAE3CQ,EAAG,SAAQ;AAAA,EAEnB,GAAOL,IAAU,MAAO,EAAE;AAC1B;AAEA,MAAMM,IAAKC,EAAa,YAAY,GAAG,GACjCC,IAAY,UAAUF;AAE5BG,EAAS,IAAIH,GAAI,IAAMV,GAAUY,GAAWV,CAAI;"}