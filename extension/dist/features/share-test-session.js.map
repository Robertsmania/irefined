{"version":3,"file":"share-test-session.js","sources":["../../src/features/share-test-session.jsx"],"sourcesContent":["import { getFeatureID } from '../helpers/feature-helpers.js';\r\nimport features from '../feature-manager.js';\r\nimport { findState } from '../helpers/react-resolver.js';\r\nimport React from 'dom-chef';\r\nimport { $ } from 'select-dom';\r\n\r\nconst selector = '#test-drive-modal';\r\n\r\nasync function initConditions(activate = true) {\r\n\r\n    if (!activate) {\r\n        return;\r\n    }\r\n\r\n    const modalState = findState($(selector), 1);\r\n\r\n    const getJsonUpload = () =>\r\n        new Promise(resolve => {\r\n            const inputFileElement = document.createElement('input')\r\n            inputFileElement.setAttribute('type', 'file')\r\n            inputFileElement.setAttribute('accept', '.json')\r\n\r\n            inputFileElement.addEventListener(\r\n                'change',\r\n                async (event) => {\r\n                    const { files } = event.target\r\n                    if (!files) {\r\n                        return\r\n                    }\r\n\r\n                    const filePromises = [...files].map(file => file.text())\r\n\r\n                    resolve(await Promise.all(filePromises))\r\n                },\r\n                false,\r\n            )\r\n            inputFileElement.click()\r\n        })\r\n\r\n    const handleUpload = async () => {\r\n        const json = await getJsonUpload();\r\n        modalState.setState(JSON.parse(json[0]));\r\n    }\r\n\r\n    function getJsonDownload(text, name) {\r\n        const a = document.createElement('a');\r\n        const type = name.split(\".\").pop();\r\n        a.href = URL.createObjectURL(new Blob([text], { type: `text/${type === \"txt\" ? \"plain\" : type}` }));\r\n        a.download = name;\r\n        a.click();\r\n    }\r\n\r\n    const handleDownload = async () => {\r\n        const sessionVars = {\r\n            carId: modalState.state.carId,\r\n            carClassId: modalState.state.carClassId,\r\n            climateChange: modalState.state.climateChange,\r\n            damageModel: modalState.state.damageModel,\r\n            timeOfDay: modalState.state.timeOfDay,\r\n            trackId: modalState.state.trackId,\r\n            trackState: modalState.state.trackState,\r\n            weather: modalState.state.weather\r\n        }\r\n\r\n        const date = new Date();\r\n        const dateString = date.toISOString().substring(0, 10);\r\n        getJsonDownload(JSON.stringify(sessionVars), `testing-conditions-${dateString}.json`);\r\n    }\r\n\r\n    const buttonEl = (\r\n        <div style={{display: \"inline\"}}>\r\n            <button id=\"upload-button\" onClick={handleUpload} class=\"btn btn-sm btn-primary pull-xs-left\">\r\n                Upload\r\n            </button>\r\n            <button id=\"download-button\" onClick={handleDownload} class=\"btn btn-sm btn-primary pull-xs-left\">\r\n                Download\r\n            </button>\r\n        </div>\r\n    );\r\n\r\n    $(selector).querySelector('.modal-footer > .centered-horizontal').prepend(buttonEl);\r\n\r\n}\r\n\r\nconst id = getFeatureID(import.meta.url);\r\nconst bodyClass = 'iref-' + id;\r\n\r\nfeatures.add(id, true, selector, bodyClass, initConditions);\r\n"],"names":["selector","initConditions","activate","modalState","findState","$","getJsonUpload","resolve","inputFileElement","event","files","filePromises","file","handleUpload","json","getJsonDownload","text","name","a","type","handleDownload","sessionVars","dateString","buttonEl","React","id","getFeatureID","bodyClass","features"],"mappings":";;;;;AAMA,MAAMA,IAAW;AAEjB,eAAeC,EAAeC,IAAW,IAAM;AAE3C,MAAI,CAACA;AACD;AAGJ,QAAMC,IAAaC,EAAUC,EAAEL,CAAQ,GAAG,CAAC,GAErCM,IAAgB,MAClB,IAAI,QAAQ,CAAWC,MAAA;AACb,UAAAC,IAAmB,SAAS,cAAc,OAAO;AACtC,IAAAA,EAAA,aAAa,QAAQ,MAAM,GAC3BA,EAAA,aAAa,UAAU,OAAO,GAE9BA,EAAA;AAAA,MACb;AAAA,MACA,OAAOC,MAAU;AACP,cAAA,EAAE,OAAAC,MAAUD,EAAM;AACxB,YAAI,CAACC;AACD;AAGE,cAAAC,IAAe,CAAC,GAAGD,CAAK,EAAE,IAAI,CAAAE,MAAQA,EAAK,MAAM;AAEvD,QAAAL,EAAQ,MAAM,QAAQ,IAAII,CAAY,CAAC;AAAA,MAC3C;AAAA,MACA;AAAA,IACJ,GACAH,EAAiB,MAAM;AAAA,EAAA,CAC1B,GAECK,IAAe,YAAY;AACvB,UAAAC,IAAO,MAAMR,EAAc;AACjC,IAAAH,EAAW,SAAS,KAAK,MAAMW,EAAK,CAAC,CAAC,CAAC;AAAA,EAC3C;AAES,WAAAC,EAAgBC,GAAMC,GAAM;AAC3B,UAAAC,IAAI,SAAS,cAAc,GAAG,GAC9BC,IAAOF,EAAK,MAAM,GAAG,EAAE,IAAI;AACjC,IAAAC,EAAE,OAAO,IAAI,gBAAgB,IAAI,KAAK,CAACF,CAAI,GAAG,EAAE,MAAM,QAAQG,MAAS,QAAQ,UAAUA,CAAI,GAAA,CAAI,CAAC,GAClGD,EAAE,WAAWD,GACbC,EAAE,MAAM;AAAA,EAAA;AAGZ,QAAME,IAAiB,YAAY;AAC/B,UAAMC,IAAc;AAAA,MAChB,OAAOlB,EAAW,MAAM;AAAA,MACxB,YAAYA,EAAW,MAAM;AAAA,MAC7B,eAAeA,EAAW,MAAM;AAAA,MAChC,aAAaA,EAAW,MAAM;AAAA,MAC9B,WAAWA,EAAW,MAAM;AAAA,MAC5B,SAASA,EAAW,MAAM;AAAA,MAC1B,YAAYA,EAAW,MAAM;AAAA,MAC7B,SAASA,EAAW,MAAM;AAAA,IAC9B,GAGMmB,yBADW,KAAK,GACE,YAAc,EAAA,UAAU,GAAG,EAAE;AACrD,IAAAP,EAAgB,KAAK,UAAUM,CAAW,GAAG,sBAAsBC,CAAU,OAAO;AAAA,EACxF,GAEMC,IACD,gBAAAC,EAAA,cAAA,OAAA,EAAI,OAAO,EAAC,SAAS,SAAA,EAClB,GAAA,gBAAAA,EAAA,cAAC,UAAO,EAAA,IAAG,iBAAgB,SAASX,GAAc,OAAM,sCAAsC,GAAA,QAE9F,GACA,gBAAAW,EAAA,cAAC,UAAO,EAAA,IAAG,mBAAkB,SAASJ,GAAgB,OAAM,sCAAsC,GAAA,UAElG,CACJ;AAGJ,EAAAf,EAAEL,CAAQ,EAAE,cAAc,sCAAsC,EAAE,QAAQuB,CAAQ;AAEtF;AAEA,MAAME,IAAKC,EAAa,YAAY,GAAG,GACjCC,IAAY,UAAUF;AAE5BG,EAAS,IAAIH,GAAI,IAAMzB,GAAU2B,GAAW1B,CAAc;"}